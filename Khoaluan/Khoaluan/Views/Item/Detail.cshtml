@using Khoaluan.OtpModels
@model Khoaluan.OtpModels.DetailPage
@{
    ViewData["Title"] = "Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
    TempData.Keep("idpro");
    List<Cart> carts = ViewBag.GioHang;
    List<LibraryDetail> DanhSachDonHang = ViewBag.DonHang;
}
<div class="nk-main">
    <!-- START: Breadcrumbs -->
    <div class="nk-gap-1"></div>
    <div class="container">
        <ul class="nk-breadcrumbs">


            <li><a href="index.html">Home</a></li>


            <li><span class="fa fa-angle-right"></span></li>

            <li><a href="store.html">Store</a></li>


            <li><span class="fa fa-angle-right"></span></li>

            <li><a href="store-catalog.html">Action Games</a></li>


            <li><span class="fa fa-angle-right"></span></li>

            <li><span>@Model.productDetail.Name </span></li>

        </ul>
    </div>
    <div class="nk-gap-1"></div>
    <!-- END: Breadcrumbs -->




    <div class="container">
        <div class="row vertical-gap">
            <div class="col-lg-8">
                <div class="nk-store-product">
                    <div class="row vertical-gap">
                        <div class="col-md-6">
                            <!-- START: Product Photos -->
                            <div class="nk-popup-gallery">
                                    <div class="nk-gallery-item-box">
                                        <a href="~/assets/images/product-6.jpg" class="nk-gallery-item" data-size="1200x554">
                                            <div class="nk-gallery-item-overlay"><span class="ion-eye"></span></div>
                                            <img src="~/Images/@Url.Content(Model.productDetail.Image)" alt="">
                                        </a>
                                    </div>
                                </div>
                            <!-- END: Product Photos -->
                        </div>
                        <div class="col-md-6">

                            <h2 class="nk-product-title h3">@Model.productDetail.Name </h2>

                            <select class="form-control">
                                <option value="" disabled selected>Select Platform</option>
                                <option value="ps4">PS4</option>
                                <option value="xbox">Xbox 1</option>
                                <option value="pc">PC</option>
                            </select>

                            <div class="nk-product-description">
                                <p>@Model.productDetail.Overview</p>
                            </div>

                            <!-- START: Add to Cart -->
                            <div class="nk-gap-2"></div>
                            <form action="#" class="nk-product-addtocart">
                                <div class="nk-product-price">€ @Model.productDetail.Price</div>
                                <div class="nk-gap-1"></div>
                                <div class="input-group">
                                    <input type="number" id="txtsoLuong" name="txtsoLuong" class="form-control" value="1" min="1" max="21">
                                    @{
                                        int productID = Model.productDetail.Id;
                                        @*ViewBag.name = TempData["idpro"];

                                            if (ViewBag.name != null)
                                            {
                                                int proid = int.Parse(ViewBag.name);
                                                //foreach (var item in ViewBag.name)
                                                //{
                                                if (proid == productID)
                                                {
                                                    <div>
                                                        <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="/cart.html">In Cart</button>
                                                    </div>
                                                }
                                                else
                                                {*@
                                        @if (User.Identity.IsAuthenticated)
                                        {
                                            if (DanhSachDonHang != null)
                                            {
                                                if (DanhSachDonHang.Any(t => t.UserID == int.Parse(ViewBag.GetId) && t.Id == productID))
                                                {
                                                    <div>
                                                        <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">In Library</button>
                                                        <input hidden asp-for="@productID" />
                                                    </div>
                                                }
                                                else if (ViewBag.GioHang != null)
                                                {

                                                    if (carts.Any(t => t.product.Id == productID))
                                                    {
                                                        <div>
                                                            <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">In Cart</button>
                                                            <input hidden asp-for="@productID" />
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="add-to-cart">
                                                            <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">Add to Cart</button>
                                                            <input hidden asp-for="@productID" />
                                                        </div>
                                                    }
                                                }
                                                else
                                                {
                                                    <div class="add-to-cart">
                                                        <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">Add to Cart</button>
                                                        <input hidden asp-for="@productID" />
                                                    </div>
                                                }
                                            }
                                            else if (ViewBag.GioHang != null)
                                            {

                                                if (carts.Any(t => t.product.Id == productID))
                                                {
                                                    <div>
                                                        <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">In Cart</button>
                                                        <input hidden asp-for="@productID" />
                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="add-to-cart">
                                                        <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">Add to Cart</button>
                                                        <input hidden asp-for="@productID" />
                                                    </div>
                                                }
                                            }
                                            else
                                            {
                                                <div class="add-to-cart">
                                                    <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">Add to Cart</button>
                                                    <input hidden asp-for="@productID" />
                                                </div>
                                            }
                                        }
                                        else
                                        {
                                            @if (ViewBag.GioHang != null)
                                            {

                                                if (carts.Any(t => t.product.Id == productID))
                                                {
                                                    <div>
                                                        <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">In Cart</button>
                                                        <input hidden asp-for="@productID" />
                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="add-to-cart">
                                                        <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">Add to Cart</button>
                                                        <input hidden asp-for="@productID" />
                                                    </div>
                                                }
                                            }
                                            else
                                            {
                                                <div class="add-to-cart">
                                                    <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">Add to Cart</button>
                                                    <input hidden asp-for="@productID" />
                                                </div>
                                            }
                                        }




                                        @*}
                                                //}
                                            }
                                            else
                                            {
                                                <div class="add-to-cart">
                                                    <button class="nk-btn nk-btn-rounded nk-btn-color-main-1" href="javascript:void(0)">Add to Cart</button>
                                                    <input hidden asp-for="@productID" />
                                                </div>
                                            }*@
                                    }
                                </div>
                            </form>
                            <div class="nk-gap-3"></div>
                            <!-- END: Add to Cart -->
                            <!-- START: Meta -->
                            <div class="nk-product-meta">
                                    <div>
                                        <strong>Developer</strong>:
                                        @{
                                            string name = @Model.productDetail.DevName;
                                            string url1 = $"/Product/HomePage/Dev/{name}.html";
                                            <a href="@url1">@Model.productDetail.DevName</a>
                                        }

                                    </div>
                                    <div>
                                        <strong>Categories</strong>:
                                        @foreach (var item in Model.productDetail.Categories)
                                        {
                                            string url = $"/Product/HomePage/Cate/{item}.html";
                                            <a href="@url">@item,</a>
                                        }
                                    </div>
                                </div>

                            <!-- END: Meta -->
                        </div>
                    </div>

                    <!-- START: Share -->
                    <div class="nk-gap-2"></div>
                    <div class="nk-post-share">
                        <span class="h5">Share Product:</span>
                        <ul class="nk-social-links-2">
                            <li><span class="nk-social-facebook" title="Share page on Facebook" data-share="facebook"><span class="fab fa-facebook"></span></span></li>
                            <li><span class="nk-social-google-plus" title="Share page on Google+" data-share="google-plus"><span class="fab fa-google-plus"></span></span></li>
                            <li><span class="nk-social-twitter" title="Share page on Twitter" data-share="twitter"><span class="fab fa-twitter"></span></span></li>
                            <li><span class="nk-social-pinterest" title="Share page on Pinterest" data-share="pinterest"><span class="fab fa-pinterest-p"></span></span></li>
                        </ul>
                    </div>
                    <!-- END: Share -->

                    <div class="nk-gap-2"></div>
                    <!-- START: Tabs -->
                    <div class="nk-tabs">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" href="#tab-description" role="tab" data-toggle="tab">Description</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#tab-reviews" role="tab" data-toggle="tab">Reviews (3)</a>
                            </li>
                        </ul>

                        <div class="tab-content">

                            <!-- START: Tab Description -->
                            <div role="tabpanel" class="tab-pane fade show active" id="tab-description">
                                    <div class="nk-gap"></div>
                                    <strong class="text-white">Release Date: @Model.productDetail.ReleaseDate</strong>
                                    <div class="nk-gap"></div>
                                    <p>@Model.productDetail.Description</p>

                                    <div class="nk-product-info-row row vertical-gap">
                                        <div class="col-md-5">
                                            <div class="nk-product-pegi">
                                                <div class="nk-gap"></div>
                                                <img src="~/assets/images/pegi-icon.jpg" alt="">
                                                <div class="nk-product-pegi-cont">
                                                    <strong class="text-white">Pegi Rating:</strong>
                                                    <div class="nk-gap"></div>
                                                    Suitable for people aged 12 and over.
                                                </div>
                                                <div class="nk-gap"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="nk-gap"></div>
                                            <strong class="text-white">Genre:</strong>
                                            <div class="nk-gap"></div>
                                            TBD
                                            <div class="nk-gap"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="nk-gap"></div>
                                            <strong class="text-white">Customer Rating:</strong>
                                            <div class="nk-gap"></div>
                                            <div class="nk-product-rating" data-rating="4.5"> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fas fa-star-half"></i></div>
                                            <div class="nk-gap"></div>
                                        </div>
                                    </div>
                                </div>
                            <!-- END: Tab Description -->
                            <!-- START: Tab Reviews -->
                            <div role="tabpanel" class="tab-pane fade" id="tab-reviews">
                                <div class="nk-gap-2"></div>
                                <!-- START: Reply -->
                                <h3 class="h4">Add a Review</h3>
                                <div class="nk-reply">
                                    <form action="#" class="nk-form">
                                        <div class="row vertical-gap sm-gap">
                                            <div class="col-sm-6">
                                                <input type="text" class="form-control required" name="name" placeholder="Name *">
                                            </div>
                                            <div class="col-sm-6">
                                                <input type="text" class="form-control required" name="title" placeholder="Title *">
                                            </div>
                                        </div>
                                        <div class="nk-gap-1"></div>
                                        <textarea class="form-control required" name="message" rows="5" placeholder="Your Review *" aria-required="true"></textarea>
                                        <div class="nk-gap-1"></div>
                                        <div class="nk-rating">
                                            <input type="radio" id="review-rate-5" name="review-rate" value="5">
                                            <label for="review-rate-5">
                                                <span><i class="far fa-star"></i></span>
                                                <span><i class="fa fa-star"></i></span>
                                            </label>

                                            <input type="radio" id="review-rate-4" name="review-rate" value="4">
                                            <label for="review-rate-4">
                                                <span><i class="far fa-star"></i></span>
                                                <span><i class="fa fa-star"></i></span>
                                            </label>

                                            <input type="radio" id="review-rate-3" name="review-rate" value="3">
                                            <label for="review-rate-3">
                                                <span><i class="far fa-star"></i></span>
                                                <span><i class="fa fa-star"></i></span>
                                            </label>

                                            <input type="radio" id="review-rate-2" name="review-rate" value="2">
                                            <label for="review-rate-2">
                                                <span><i class="far fa-star"></i></span>
                                                <span><i class="fa fa-star"></i></span>
                                            </label>

                                            <input type="radio" id="review-rate-1" name="review-rate" value="1">
                                            <label for="review-rate-1">
                                                <span><i class="far fa-star"></i></span>
                                                <span><i class="fa fa-star"></i></span>
                                            </label>
                                        </div>
                                        <button class="nk-btn nk-btn-rounded nk-btn-color-dark-3 float-right">Submit</button>
                                    </form>
                                </div>
                                <!-- END: Reply -->

                                <div class="clearfix"></div>
                                <div class="nk-gap-2"></div>
                                <div class="nk-comments">
                                    <!-- START: Review -->
                                    <div class="nk-comment">
                                        <div class="nk-comment-meta">
                                            <img src="~/assets/images/avatar-2.jpg" alt="Witch Murder" class="rounded-circle" width="35"> by <a href="#">Witch Murder</a> in 20 September, 2018
                                            <div class="nk-review-rating" data-rating="4.5"> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="far fa-star"></i></div>
                                        </div>
                                        <div class="nk-comment-text">
                                            <p>Upon replenish great rule. Were tree, given day him night Fruit it moveth all. First they're creature seasons and creature fill a it have fifth, their own subdue brought above divided.</p>

                                            <p>Behold it set, seas seas and meat divided Moveth cattle forth evening above moveth so, signs god a fruitful his after called that whose.</p>
                                        </div>
                                    </div>
                                    <!-- END: Review -->
                                    <!-- START: Review -->
                                    <div class="nk-comment">
                                        <div class="nk-comment-meta">
                                            <img src="~/assets/images/avatar-1.jpg" alt="Hitman" class="rounded-circle" width="35"> by <a href="#">Hitman</a> in 14 Jule, 2018
                                            <div class="nk-review-rating" data-rating="0.5"> <i class="fa fa-star"></i> <i class="far fa-star"></i> <i class="far fa-star"></i> <i class="far fa-star"></i> <i class="far fa-star"></i></div>
                                        </div>
                                        <div class="nk-comment-text">
                                            <p> I was awakened at daybreak by the charwoman, and having arrived at the inn, was at first placed inside the coach. :(</p>
                                        </div>
                                    </div>
                                    <!-- END: Review -->
                                    <!-- START: Review -->
                                    <div class="nk-comment">
                                        <div class="nk-comment-meta">
                                            <img src="~/assets/images/avatar-3.jpg" alt="Wolfenstein" class="rounded-circle" width="35"> by <a href="#">Wolfenstein</a> in 27 June, 2018
                                            <div class="nk-review-rating" data-rating="3.5"> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i></div>
                                        </div>
                                        <div class="nk-comment-text">
                                            <p>Divided thing, land it evening earth winged whose great after. Were grass night. To Air itself saw bring fly fowl. Fly years behold spirit day greater of wherein winged and form. Seed open don't thing midst created dry every greater divided of, be man is. Second Bring stars fourth gathering he hath face morning fill. Living so second darkness. Moveth were male. May creepeth. Be tree fourth.</p>
                                        </div>
                                    </div>
                                    <!-- END: Review -->
                                </div>
                            </div>
                            <!-- END: Tab Reviews -->

                        </div>
                    </div>
                    <!-- END: Tabs -->
                </div>

                <!-- START: Related Products -->
                <div class="nk-gap-3"></div>
                <h3 class="nk-decorated-h-2"><span><span class="text-main-1">Related</span> Products</span></h3>
                <div class="nk-gap"></div>
                <div class="row vertical-gap">
                        @foreach (var p in Model.relateGame)
                        {
                            string url = $"/Product/HomePage/{p.Id}.html";
                            <div class="col-md-6">
                                <div class="nk-product-cat">
                                    <a class="nk-product-image" href="@url">
                                        <img src="~/Images/@p.Image" alt=@p.Name>
                                    </a>
                                    <div class="nk-product-cont">
                                        <h3 class="nk-product-title h5"><a href="@url">@p.Name</a></h3>
                                        <div class="nk-gap-1"></div>
                                        <div class="nk-product-rating">
                                            @for (int i = 1; i <= p.Id / 10; i++)
                                            {
                                                <i class="fa fa-star"></i>
                                            }

                                        </div>
                                        <div class="nk-gap-1"></div>
                                        <div class="nk-product-price">€ @p.Price</div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                <!-- END: Related Products -->
            </div>
            <div class="col-lg-4">
                <aside class="nk-sidebar nk-sidebar-right nk-sidebar-sticky">
                    <div class="nk-widget">
                        <div class="nk-widget-content">
                            <form action="#" class="nk-form nk-form-style-1" novalidate="novalidate">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Type something...">
                                    <button class="nk-btn nk-btn-color-main-1"><span class="ion-search"></span></button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="nk-widget nk-widget-highlighted">
                        <h4 class="nk-widget-title"><span><span class="text-main-1">Category</span> Menu</span></h4>
                        <div class="nk-widget-content">
                            <p>
                                <ul class="nk-widget-categories">
                                    @if (Model.cate != null && Model.cate.Count() > 0)
                                    {
                                        foreach (var item in Model.cate.Take(5))
                                        {
                                            string url = $"/Product/HomePage/Cate/{item.Name}.html";
                                            <li><a href="@url">@item.Name</a></li>
                                        }
                                        <span id="dots"></span>
                                        <div style="border-top: 1px solid #293139;"></div>
                                        <span id="more">
                                            @foreach (var item in Model.cate.Skip(5))
                                            {
                                            string url = $"/Product/HomePage/Cate/{item.Name}.html";
                                        <li><a href="@url">@item.Name</a></li>

                                        }
                                        </span>
                                    }

                                </ul>
                            </p>
                            <div style="margin-top: 1.5rem"></div>
                            <button onclick="myFunction()" id="myBtn">Read more</button>
                        </div>
                    </div>
                    <div class="nk-widget nk-widget-highlighted">
                        <h4 class="nk-widget-title"><span><span class="text-main-1">Price</span> Filter</span></h4>
                        <div class="nk-widget-content">
                            <div class="nk-input-slider">
                                <input type="text"
                                       name="price-filter"
                                       data-slider-min="0"
                                       data-slider-max="1800"
                                       data-slider-step="1"
                                       data-slider-value="[200, 1200]"
                                       data-slider-tooltip="hide">
                                <div class="nk-gap"></div>
                                <div>
                                    <div class="text-white mt-4 float-left">
                                        PRICE:
                                        <strong class="text-main-1">€ <span class="nk-input-slider-value-0"></span></strong>
                                        -
                                        <strong class="text-main-1">€ <span class="nk-input-slider-value-1"></span></strong>
                                    </div>
                                    <a href="#" class="nk-btn nk-btn-rounded nk-btn-color-white float-right">Apply</a>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                    <div class="nk-widget nk-widget-highlighted">
                        <h4 class="nk-widget-title"><span><span class="text-main-1">We</span> Are Social</span></h4>
                        <div class="nk-widget-content">
                            <ul class="nk-social-links-3 nk-social-links-cols-4">
                                <li><a class="nk-social-twitch" href="#"><span class="fab fa-twitch"></span></a></li>
                                <li><a class="nk-social-instagram" href="#"><span class="fab fa-instagram"></span></a></li>
                                <li><a class="nk-social-facebook" href="#"><span class="fab fa-facebook"></span></a></li>
                                <li><a class="nk-social-google-plus" href="#"><span class="fab fa-google-plus"></span></a></li>
                                <li><a class="nk-social-youtube" href="#"><span class="fab fa-youtube"></span></a></li>
                                <li><a class="nk-social-twitter" href="#" target="_blank"><span class="fab fa-twitter"></span></a></li>
                                <li><a class="nk-social-pinterest" href="#"><span class="fab fa-pinterest-p"></span></a></li>
                                <li><a class="nk-social-rss" href="#"><span class="fa fa-rss"></span></a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="nk-widget nk-widget-highlighted">
                        <h4 class="nk-widget-title"><span><span class="text-main-1">Most</span> Popular</span></h4>
                        <div class="nk-widget-content">

                            @foreach (var item in Model.popularGame)
                                {
                                    string url = $"/Product/HomePage/{item.Id}.html";
                                    <div class="nk-widget-post">
                                        <a href="@url" class="nk-post-image">
                                            <img src="~/Images/@item.Image" alt=@item.Name>
                                        </a>
                                        <h3 class="nk-post-title"><a href="@url">@item.Name</a></h3>
                                        <div class="nk-product-rating">
                                            @for (int i = 1; i <= item.Id / 20; i++)
                                            {
                                                <i class="fa fa-star"></i>
                                            }
                                        </div>
                                        <div class="nk-product-price">€ @item.Price</div>
                                    </div>
                                }
                        </div>
                    </div>
                </aside>
                <!-- END: Sidebar -->
            </div>
        </div>
    </div>




</div>




<!-- START: Page Background -->

<img class="nk-page-background-top" src="~/assets/images/bg-top-4.png" alt="">
<img class="nk-page-background-bottom" src="~/assets/images/bg-bottom.png" alt="">
@section Styles{
    <style>
        #more {
            display: none;
        }

        p {
            margin-bottom: 0;
        }

        .divreadmore {
            margin-top: 5px;
        }
    </style>
}
@section Scripts {
    <script>
        $(document).ready(function () {
            $(function () {
                function loadHeaderCart() {
                    $('#miniCart').load("/AjaxContent/HeaderCart");
                    $('#numberCart').load("/AjaxContent/NumberCart");
                }
                $(".add-to-cart").click(function () {
                    var productid = $('#productID').val();
                    $.ajax({
                        url: '/api/cart/add',
                        type: "POST",
                        dataType: "JSON",
                        data: {
                            productID: productid
                        },
                        async: false,
                        cache: false,
                        success: function (response) {
                            if (response.result == 'Redirect') {
                                window.location = response.url;
                            }
                            else {
                                loadHeaderCart(); //Add Product success
                                location.reload();
                            }
                            console.log(response); // log to the console to see whether it worked
                        },
                        error: function (error) {
                            alert("There was an error posting the data to the server: " + error.responseText);
                        }
                    });
                });
            });
        });
    </script>
    <script type="text/javascript">
        function myFunction() {
            var dots = document.getElementById("dots");
            var moreText = document.getElementById("more");
            var btnText = document.getElementById("myBtn");

            if (dots.style.display === "none") {
                dots.style.display = "inline";
                btnText.innerHTML = "Read more";
                moreText.style.display = "none";
            } else {
                dots.style.display = "none";
                btnText.innerHTML = "Read less";
                moreText.style.display = "inline";
            }
        }
    </script>
}
